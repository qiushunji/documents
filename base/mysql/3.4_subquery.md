# 子查询

查询一般指 SELECT 语句，那么所谓的子查询指的是嵌套在查询中的查询

<br/>



### 简单示例

需求：有一张研究生在读信息表，用子查询方式查询哪些专业报考人数少，考研人需要看看该专业的师兄师姐的信息。

1、专业学生人数不大于2人

2、这些专业的学生信息

```sql
SELECT
	id,sName,sCampus,sCollege,sMajor,sType
FROM
	`students` 
WHERE
	sMajor IN ( SELECT sMajor FROM `students` GROUP BY sMajor HAVING count( * ) <= 2 )
```

执行结果

```sql
+------------+--------+--------------+----------+----------------------+------------+
| id         | sName  | sCampus      | sCollege | sMajor               | sType      |
+------------+--------+--------------+----------+----------------------+------------+
| 2018000013 | 蔡佳吴 | 海珠区北校区 | 物理学院 | 物理学               | 硕士研究生 |
| 2018000014 | 王宝强 | 海珠区北校区 | 物理学院 | 物理学               | 硕士研究生 |
| 2018000015 | 成立里 | 海珠区北校区 | 物理学院 | 材料工程             | 硕士研究生 |
| 2018000016 | 萨哈那 | 海珠区北校区 | 物理学院 | 材料工程             | 硕士研究生 |
| 2018000027 | 赵门依 | 珠海校区     | 医学院   | 人体解剖与组织胚胎学 | 硕士研究生 |
| 2018000028 | 黎明涛 | 珠海校区     | 医学院   | 人体解剖与组织胚胎学 | 硕士研究生 |
+------------+--------+--------------+----------+----------------------+------------+
6 rows in set (0.05 sec)
```

使用子查询时，优先执行子查询，然后执行父查询。分析如下：

首先通过

```sql
SELECT sMajor FROM students GROUP BY sMajor HAVING count( * ) <= 2;
```

查询出满足不大于2人的专业，**人体解剖与组织胚胎学、材料工程和物理学**

其次执行

```sql
SELECT 
	id,sName,sCampus,sCollege,sMajor,sType 
FROM 
	`students` 
WHERE sMajor IN ( '人体解剖与组织胚胎学','材料工程','物理学');
```

不妨试试不用子查询是否能实现查询需求？

!>**分成多行SQL可以方便阅读和调试，`;`是SQL语句的结尾**

<br/>



#### 子查询作为计算字段

查询每位导师都有几位研究生，用到教师表和导师双向选择表

```sql
SELECT
	id,
	sName,
	sMajor,
	( SELECT COUNT( * ) FROM tutors WHERE tutors.iTeacherID = teacher.id ) AS '学生人数' 
FROM
	teacher;
```

执行结果

```sql
+------------+--------+----------+----------+
| id         | sName  | sMajor   | 学生人数 |
+------------+--------+----------+----------+
| 2006001002 | 赵季能 | 网络工程 |        0 |
| 2006001003 | 刘晓梁 | 物理学   |        2 |
| 2006001004 | 米蓝   | 材料工程 |        2 |
| 2006001005 | 吴丹丹 | 临床医学 |        0 |
| 2006001006 | 吴一杭 | 临床医学 |        0 |
| 2006001007 | 刘冷惜 | 基础医学 |        3 |
| 2006001008 | 李明落 | 俄语     |        0 |
| 2006001009 | 瓦里丹 | 西班牙语 |        5 |
| 2006001010 | 斯蒂芬 | 法语     |        0 |
| 2006001011 | 苏明凯 | 英语     |        0 |
| 2006001012 | 郑嘉仪 | 日语     |        6 |
+------------+--------+----------+----------+
11 rows in set (0.05 sec)
```

<br/>

!> 子查询在实际应用中十分常见，本文只介绍简单用法，更多详细应用请查看进阶教程

